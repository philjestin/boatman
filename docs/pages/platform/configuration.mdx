# Configuration

This page covers all configuration options for the Boatman Platform server and the CLI's platform integration.

## Server Flags

The platform binary accepts the following command-line flags:

```bash
boatman-platform --port 8080 --data-dir ~/.boatman/platform
```

| Flag | Default | Description |
|------|---------|-------------|
| `--port` | `8080` | HTTP server port |
| `--data-dir` | `~/.boatman/platform` | Data directory for SQLite database and NATS storage |

The data directory is created automatically if it does not exist. It contains:

```
~/.boatman/platform/
├── platform.db    # SQLite database (runs, memory, costs, policies, events)
└── nats/          # Embedded NATS JetStream data
```

---

## CLI Configuration

The CLI connects to the platform via the `platform` section in `.boatman.yaml`. This file can be placed globally at `~/.boatman.yaml` or per-project as `.boatman.yaml` in the project root.

```yaml
platform:
  server: http://localhost:8080
  org_id: my-org
  team_id: my-team
```

| Field | Config Key | Description |
|-------|-----------|-------------|
| `server` | `platform.server` | Platform server URL. When empty, the CLI runs in standalone mode. |
| `org_id` | `platform.org_id` | Organization identifier. |
| `team_id` | `platform.team_id` | Team identifier. |

When the `server` field is empty or omitted, the CLI operates in standalone mode with no platform features. All core functionality (execution, review, testing) works without a platform connection.

---

## Example Configurations

### Local Development (Single Developer)

A single developer running the platform locally for personal cost tracking and memory persistence:

```yaml
# .boatman.yaml (project root)
linear_key: lin_api_xxxxx

max_iterations: 5
base_branch: main
auto_pr: true

claude:
  models:
    planner: claude-sonnet-4-5
    executor: claude-sonnet-4-5
    reviewer: claude-sonnet-4-5
    refactor: claude-sonnet-4-5
    preflight: claude-haiku-4
    test_runner: claude-haiku-4

platform:
  server: http://localhost:8080
  org_id: personal
  team_id: default
```

Start the server:

```bash
boatman-platform --port 8080
```

---

### Team Server (Shared Team Instance)

A shared platform instance for a development team. All team members point their CLIs at the same server to share memory patterns and enforce team-wide policies.

```yaml
# ~/.boatman.yaml (global config for each team member)
platform:
  server: http://platform.internal:8080
  org_id: acme-corp
  team_id: backend
```

Start the server on a shared machine:

```bash
boatman-platform --port 8080 --data-dir /var/lib/boatman/platform
```

Set up team-wide policies via the dashboard or API:

```bash
curl -X PUT http://platform.internal:8080/api/v1/policies \
  -H "Content-Type: application/json" \
  -H "X-Boatman-Org: acme-corp" \
  -H "X-Boatman-Team: backend" \
  -d '{
    "max_iterations": 5,
    "max_cost_per_run": 2.00,
    "max_files_changed": 20,
    "require_tests": true,
    "require_review": true,
    "allowed_models": ["claude-sonnet-4-5", "claude-haiku-4"]
  }'
```

Set a monthly budget:

```bash
curl -X PUT http://platform.internal:8080/api/v1/costs/budget \
  -H "Content-Type: application/json" \
  -H "X-Boatman-Org: acme-corp" \
  -H "X-Boatman-Team: backend" \
  -d '{
    "monthly_limit": 500.00,
    "daily_limit": 50.00,
    "per_run_limit": 5.00,
    "alert_at": 0.8
  }'
```

---

### Production Deployment

A production deployment using systemd for process management and regular data backups.

#### systemd Service

Create `/etc/systemd/system/boatman-platform.service`:

```ini
[Unit]
Description=Boatman Platform Server
After=network.target

[Service]
Type=simple
User=boatman
Group=boatman
ExecStart=/usr/local/bin/boatman-platform --port 8080 --data-dir /var/lib/boatman/platform
Restart=always
RestartSec=5
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
```

Enable and start:

```bash
sudo systemctl enable boatman-platform
sudo systemctl start boatman-platform
```

#### Data Backup

Back up the SQLite database regularly. The database is a single file at `{data-dir}/platform.db`:

```bash
#!/bin/bash
# /etc/cron.daily/boatman-backup
BACKUP_DIR=/var/backups/boatman
DATA_DIR=/var/lib/boatman/platform
DATE=$(date +%Y%m%d)

mkdir -p "$BACKUP_DIR"
sqlite3 "$DATA_DIR/platform.db" ".backup '$BACKUP_DIR/platform-$DATE.db'"

# Keep last 30 days
find "$BACKUP_DIR" -name "platform-*.db" -mtime +30 -delete
```

---

## Environment Variables

The platform server does not use environment variables for configuration -- all settings are passed via flags.

The CLI reads platform-related settings from `.boatman.yaml`. However, the following environment variables affect overall CLI behavior when connected to a platform:

| Variable | Description |
|----------|-------------|
| `BOATMAN_DEBUG` | Set to `1` for verbose logging including platform API calls |

Platform scope values (`org_id`, `team_id`) must be set in the `.boatman.yaml` config file. They are not configurable via environment variables.

---

## Server Initialization

For reference, the platform server initialization flow:

```go
func main() {
    port := flag.Int("port", 8080, "HTTP server port")
    dataDir := flag.String("data-dir", defaultDataDir(), "Data directory for SQLite and NATS")
    flag.Parse()

    // Create data directory
    os.MkdirAll(*dataDir, 0755)

    // Initialize SQLite storage
    dbPath := filepath.Join(*dataDir, "platform.db")
    store, _ := sqlite.New(sqlite.Options{Path: dbPath})
    defer store.Close()
    store.Migrate(ctx)

    // Initialize embedded NATS event bus
    bus, _ := eventbus.New(
        eventbus.WithPort(-1),
        eventbus.WithDataDir(filepath.Join(*dataDir, "nats")),
        eventbus.WithEventStore(store.Events()),
    )
    defer bus.Close()

    // Start HTTP server with embedded dashboard
    srv := server.New(server.Config{
        Port:  *port,
        Store: store,
        Bus:   bus,
    })
    srv.Start()
}

func defaultDataDir() string {
    home, _ := os.UserHomeDir()
    return filepath.Join(home, ".boatman", "platform")
}
```
